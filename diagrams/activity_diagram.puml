@startuml ActivityDiagram
' Customer Order Fulfillment Activity Diagram
skinparam defaultFontName "Arial"
skinparam defaultFontSize 14
skinparam dpi 150
skinparam shadowing false
skinparam activity {
  BackgroundColor #FEF5E7
  BorderColor #6F4E37
  FontColor #2C2A29
  BorderThickness 1.1
}
skinparam arrowColor #6F4E37

|Customer|
start
:Browse menu &\nadd items to cart;
if (Has account?) then (Yes)
  :Log in;
else (No)
  :Register account;
  :Log in;
endif
:Confirm pickup or\nreservation preferences;
:Submit order;

|Web App|
:Validate cart &\nreservation data;
:Check inventory & seat availability;
:Calculate totals &\ndiscounts;
:Create provisional order\n+ order items;
:Persist cart snapshot;
:Send payment request;

|Payment Gateway|
:Authorize payment;
if (Approved?) then (Yes)
  :Return approval;
else (No)
  :Return failure;
endif

|Web App|
if (Payment approved?) then (Yes)
  :Finalize order & items;
  :Record payment ledger\nentry;
  :Update inventory &\nreservation schedule;
  :Queue notification payloads;
else (No)
  :Notify payment issue;
  stop
endif

:Flush notifications;

|Notification Service|
:Deliver confirmation to\ncustomer & admin;

|Barista/Admin|
:Review work queue;
:Prepare order;
:Mark order ready;

|Customer|
:Receive ready alert\n& receipt;
stop

@enduml
